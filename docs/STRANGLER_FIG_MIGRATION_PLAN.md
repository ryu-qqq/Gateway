# Strangler Fig ë§ˆì´ê·¸ë ˆì´ì…˜ ê³„íš

## ê°œìš”

ë ˆê±°ì‹œ ì‹œìŠ¤í…œì—ì„œ ìƒˆ ì‹œìŠ¤í…œìœ¼ë¡œ ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ìœ„í•œ Strangler Fig íŒ¨í„´ ì ìš© ê³„íš.
API ë ˆë²¨ ì–´ëŒ‘í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ìŠ¤í‚¤ë§ˆ ì°¨ì´ë¥¼ í•´ê²°í•˜ë©´ì„œ ì ì§„ì ìœ¼ë¡œ ì „í™˜.

---

## í˜„ì¬ ìƒí™©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      í˜„ì¬ ì•„í‚¤í…ì²˜                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ë ˆê±°ì‹œ ì„œë²„                    ìƒˆ ì„œë²„                      â”‚
â”‚  (bootstrap-legacy-web-api)    (rest-api, rest-api-admin)   â”‚
â”‚         â”‚                              â”‚                    â”‚
â”‚         â–¼                              â–¼                    â”‚
â”‚    ë ˆê±°ì‹œ DB                        ìƒˆ DB                   â”‚
â”‚   (êµ¬ ìŠ¤í‚¤ë§ˆ)                    (ê°œì„ ëœ ìŠ¤í‚¤ë§ˆ)             â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë¬¸ì œì 
- ë ˆê±°ì‹œ ìŠ¤í‚¤ë§ˆì™€ ì‹ ê·œ ìŠ¤í‚¤ë§ˆê°€ ë‹¤ë¦„
- í•œ ë²ˆì— ì „í™˜ ì‹œ ë¦¬ìŠ¤í¬ ë†’ìŒ
- ë¡¤ë°± ì–´ë ¤ì›€

---

## ëª©í‘œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Gateway                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  /api/v2/products/** â†’ ìƒˆ ì„œë²„                          â”‚â”‚
â”‚  â”‚  /api/v2/orders/**   â†’ ìƒˆ ì„œë²„                          â”‚â”‚
â”‚  â”‚  /api/v1/**          â†’ ë ˆê±°ì‹œ (ì ì§„ì  ì¶•ì†Œ)              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â–¼                             â–¼
          ìƒˆ ì„œë²„                       ë ˆê±°ì‹œ ì„œë²„
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Application     â”‚           â”‚                 â”‚
     â”‚ Layer           â”‚           â”‚                 â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚                 â”‚
     â”‚ Adapter Layer   â”‚           â”‚                 â”‚
     â”‚ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”‚           â”‚                 â”‚
     â”‚ â”‚Leg  â”‚ â”‚New  â”‚ â”‚           â”‚                 â”‚
     â”‚ â”‚Repo â”‚ â”‚Repo â”‚ â”‚           â”‚                 â”‚
     â”‚ â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜ â”‚           â”‚                 â”‚
     â””â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚       â”‚                         â”‚
          â–¼       â–¼                         â–¼
     ë ˆê±°ì‹œ DB  ìƒˆ DB                   ë ˆê±°ì‹œ DB
```

---

## ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ëµ: API ë ˆë²¨ ì–´ëŒ‘í„°

### í•µì‹¬ ê°œë…

ìƒˆ ì„œë²„ì˜ Application LayerëŠ” ìƒˆ ìŠ¤í‚¤ë§ˆ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±í•˜ê³ ,
Adapter Layerì—ì„œ ë ˆê±°ì‹œ DB ì ‘ê·¼ ì‹œ ìŠ¤í‚¤ë§ˆ ë³€í™˜ì„ ì²˜ë¦¬.

```java
// Application Layer - ìƒˆ ìŠ¤í‚¤ë§ˆ ê¸°ì¤€
public class ProductService {
    private final ProductRepository productRepository;

    public Product getProduct(Long id) {
        return productRepository.findById(id);
    }
}

// Adapter Layer - ë ˆê±°ì‹œ DBìš© êµ¬í˜„
@Repository
public class LegacyProductRepositoryAdapter implements ProductRepository {

    private final LegacyProductJpaRepository legacyRepo;

    @Override
    public Product findById(Long id) {
        LegacyProductEntity legacy = legacyRepo.findById(id);
        return convertToNewSchema(legacy);  // ìŠ¤í‚¤ë§ˆ ë³€í™˜!
    }

    private Product convertToNewSchema(LegacyProductEntity legacy) {
        // êµ¬ë¦° ìŠ¤í‚¤ë§ˆ â†’ ìƒˆ ìŠ¤í‚¤ë§ˆ ë³€í™˜ ë¡œì§
        return Product.builder()
            .id(legacy.getProductId())
            .name(legacy.getProductNm())  // ì»¬ëŸ¼ëª… ë‹¤ë¦„
            .price(Money.of(legacy.getPrc(), legacy.getCurrCd()))  // ë¶„ë¦¬ëœ ì»¬ëŸ¼
            .build();
    }
}
```

---

## ë§ˆì´ê·¸ë ˆì´ì…˜ Phase

### Phase 1: ìƒˆ ì„œë²„ + ë ˆê±°ì‹œ DB (í˜„ì¬ ëª©í‘œ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ìƒˆ ì„œë²„                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Application (ìƒˆ ìŠ¤í‚¤ë§ˆ ê¸°ì¤€)     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                 â”‚                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ LegacyRepositoryAdapter         â”‚   â”‚
â”‚  â”‚ (ë ˆê±°ì‹œ ìŠ¤í‚¤ë§ˆ â†’ ìƒˆ ìŠ¤í‚¤ë§ˆ ë³€í™˜) â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â–¼
             ë ˆê±°ì‹œ DB
```

**ì‘ì—… ë‚´ìš©**:
- [ ] ìƒˆ ì„œë²„ì—ì„œ ë ˆê±°ì‹œ DB ì—°ê²° ì„¤ì •
- [ ] ë„ë©”ì¸ë³„ LegacyRepositoryAdapter êµ¬í˜„
- [ ] ìŠ¤í‚¤ë§ˆ ë³€í™˜ ë¡œì§ ì‘ì„±
- [ ] Gatewayì—ì„œ íŠ¹ì • API ë¼ìš°íŒ… ë³€ê²½

**ì¥ì **:
- ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ë¶ˆí•„ìš”
- ë¡¤ë°± ì‰¬ì›€ (Gateway ë¼ìš°íŒ…ë§Œ ë³€ê²½)
- ì ì§„ì  ì ìš© ê°€ëŠ¥

---

### Phase 2: ì´ì¤‘ ì“°ê¸° (Dual Write)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ìƒˆ ì„œë²„                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Application (ìƒˆ ìŠ¤í‚¤ë§ˆ ê¸°ì¤€)     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                 â”‚                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ DualWriteRepositoryAdapter      â”‚   â”‚
â”‚  â”‚ Read: ë ˆê±°ì‹œ DB                  â”‚   â”‚
â”‚  â”‚ Write: ë ˆê±°ì‹œ DB + ìƒˆ DB         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼             â–¼
       ë ˆê±°ì‹œ DB       ìƒˆ DB
```

**ì‘ì—… ë‚´ìš©**:
- [ ] ìƒˆ DB ìŠ¤í‚¤ë§ˆ ìƒì„±
- [ ] DualWriteRepositoryAdapter êµ¬í˜„
- [ ] Write ì‹œ ì–‘ìª½ DBì— ë™ì‹œ ì €ì¥
- [ ] ReadëŠ” ì—¬ì „íˆ ë ˆê±°ì‹œ DB

---

### Phase 3: ìƒˆ DBë¡œ Read ì „í™˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ìƒˆ ì„œë²„                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Application (ìƒˆ ìŠ¤í‚¤ë§ˆ ê¸°ì¤€)     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                 â”‚                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ NewPrimaryRepositoryAdapter     â”‚   â”‚
â”‚  â”‚ Read: ìƒˆ DB (Primary)            â”‚   â”‚
â”‚  â”‚ Write: ìƒˆ DB + ë ˆê±°ì‹œ DB (Sync)  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–¼             â–¼
        ìƒˆ DB        ë ˆê±°ì‹œ DB
       (Primary)     (Secondary)
```

**ì‘ì—… ë‚´ìš©**:
- [ ] ë°ì´í„° ì •í•©ì„± ê²€ì¦
- [ ] Readë¥¼ ìƒˆ DBë¡œ ì „í™˜
- [ ] ë ˆê±°ì‹œ DBëŠ” ë™ê¸°í™”ìš©ìœ¼ë¡œë§Œ ìœ ì§€

---

### Phase 4: ë ˆê±°ì‹œ DB ì œê±°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ìƒˆ ì„œë²„                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Application (ìƒˆ ìŠ¤í‚¤ë§ˆ ê¸°ì¤€)     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                 â”‚                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ NewRepository (ìµœì¢…)             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â–¼
               ìƒˆ DB
```

**ì‘ì—… ë‚´ìš©**:
- [ ] ë ˆê±°ì‹œ DB ë™ê¸°í™” ì œê±°
- [ ] ë ˆê±°ì‹œ ì„œë²„ ì œê±°
- [ ] ë ˆê±°ì‹œ DB ì•„ì¹´ì´ë¸Œ/ì‚­ì œ

---

## Gateway ë¼ìš°íŒ… ì „ëµ

### ë¼ìš°íŒ… ìš°ì„ ìˆœìœ„

```yaml
gateway:
  routing:
    services:
      # 1ï¸âƒ£ ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œëœ API (êµ¬ì²´ì  ê²½ë¡œ ë¨¼ì €)
      - id: commerce-new
        uri: http://commerce-web-api-prod.connectly.local:8080
        paths:
          - /api/v2/**           # ìƒˆ ë²„ì „ API
          - /api/v1/products/**  # ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œëœ v1 API
        hosts:
          - stage.set-of.com
          - set-of.com

      # 2ï¸âƒ£ ë ˆê±°ì‹œë¡œ í´ë°± (catch-all)
      - id: legacy-web
        uri: http://setof-commerce-legacy-api-prod.connectly.local:8080
        paths:
          - /**
        hosts:
          - stage.set-of.com
          - set-of.com
```

### ë§ˆì´ê·¸ë ˆì´ì…˜ ì§„í–‰ì— ë”°ë¥¸ ë¼ìš°íŒ… ë³€ê²½

| ë‹¨ê³„ | ìƒˆ ì„œë²„ë¡œ ë¼ìš°íŒ… | ë ˆê±°ì‹œë¡œ ë¼ìš°íŒ… |
|------|-----------------|----------------|
| Week 1 | `/api/v1/products/**` | ë‚˜ë¨¸ì§€ ì „ë¶€ |
| Week 2 | + `/api/v1/categories/**` | ë‚˜ë¨¸ì§€ ì „ë¶€ |
| Week 3 | + `/api/v1/brands/**` | ë‚˜ë¨¸ì§€ ì „ë¶€ |
| ... | ì ì  ì¶”ê°€ | ì ì  ì¶•ì†Œ |
| Final | ì „ë¶€ | ì—†ìŒ |

---

## ë¡¤ë°± ì „ëµ

### ì¦‰ì‹œ ë¡¤ë°± (Gateway ë¼ìš°íŒ…)

ë¬¸ì œ ë°œìƒ ì‹œ Gateway ì„¤ì •ì—ì„œ í•´ë‹¹ ê²½ë¡œë¥¼ ë ˆê±°ì‹œë¡œ ë³µê·€:

```yaml
# ë¡¤ë°± ì „
- /api/v1/products/** â†’ ìƒˆ ì„œë²„

# ë¡¤ë°± í›„
- /api/v1/products/** â†’ (ì œê±°, catch-allë¡œ ë ˆê±°ì‹œ ì‚¬ìš©)
```

### Circuit Breaker (ìë™ í´ë°±)

```java
@Bean
public RouteLocator routesWithCircuitBreaker(RouteLocatorBuilder builder) {
    return builder.routes()
        .route("products-with-fallback", r -> r
            .path("/api/v1/products/**")
            .filters(f -> f
                .circuitBreaker(config -> config
                    .setName("productsCircuitBreaker")
                    .setFallbackUri("forward:/fallback/legacy")))
            .uri("http://new-server"))
        .build();
}
```

---

## ë„ë©”ì¸ë³„ ë§ˆì´ê·¸ë ˆì´ì…˜ ìš°ì„ ìˆœìœ„ (ì˜ˆì‹œ)

| ìš°ì„ ìˆœìœ„ | ë„ë©”ì¸ | ì´ìœ  | ì˜ˆìƒ ë‚œì´ë„ |
|---------|--------|------|------------|
| 1 | Products | ì¡°íšŒ ìœ„ì£¼, ë¦¬ìŠ¤í¬ ë‚®ìŒ | ë‚®ìŒ |
| 2 | Categories | ë‹¨ìˆœ êµ¬ì¡° | ë‚®ìŒ |
| 3 | Brands | ë‹¨ìˆœ êµ¬ì¡° | ë‚®ìŒ |
| 4 | Users | ì¸ì¦ ì—°ë™ í•„ìš” | ì¤‘ê°„ |
| 5 | Orders | ë³µì¡í•œ ìƒíƒœ ê´€ë¦¬ | ë†’ìŒ |
| 6 | Payments | ì™¸ë¶€ ì—°ë™, ë¦¬ìŠ¤í¬ ë†’ìŒ | ë†’ìŒ |

---

## ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 1 ì‹œì‘ ì „
- [ ] ìƒˆ ì„œë²„ì—ì„œ ë ˆê±°ì‹œ DB ì ‘ì† ê°€ëŠ¥ í™•ì¸
- [ ] ìŠ¤í‚¤ë§ˆ ì°¨ì´ì  ë¬¸ì„œí™”
- [ ] ì–´ëŒ‘í„° ì¸í„°í˜ì´ìŠ¤ ì„¤ê³„
- [ ] ì²« ë²ˆì§¸ ë§ˆì´ê·¸ë ˆì´ì…˜ ë„ë©”ì¸ ì„ ì •

### ê° ë„ë©”ì¸ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œ
- [ ] LegacyRepositoryAdapter êµ¬í˜„
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±
- [ ] í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„±
- [ ] Gateway ë¼ìš°íŒ… ë³€ê²½
- [ ] ëª¨ë‹ˆí„°ë§ ì„¤ì •
- [ ] ë¡¤ë°± ê³„íš í™•ì¸

---

## ëª¨ë‹ˆí„°ë§

### ì£¼ìš” ë©”íŠ¸ë¦­

- **ì‘ë‹µ ì‹œê°„**: ìƒˆ ì„œë²„ vs ë ˆê±°ì‹œ ì„œë²„ ë¹„êµ
- **ì—ëŸ¬ìœ¨**: ìƒˆ ì„œë²„ ì—ëŸ¬ìœ¨ ëª¨ë‹ˆí„°ë§
- **íŠ¸ë˜í”½ ë¹„ìœ¨**: ìƒˆ ì„œë²„ë¡œ ê°€ëŠ” íŠ¸ë˜í”½ %

### ì•Œë¦¼ ì„¤ì •

- ìƒˆ ì„œë²„ ì—ëŸ¬ìœ¨ > 1% â†’ ì•Œë¦¼
- ì‘ë‹µ ì‹œê°„ > 500ms â†’ ì•Œë¦¼
- Circuit Breaker OPEN â†’ ì¦‰ì‹œ ì•Œë¦¼

---

## í”„ë¡œë•ì…˜ ìš´ì˜ ê°€ì´ë“œ

### ëŒ€ê¸°ì—… ì„±ê³µ ì‚¬ë¡€

| íšŒì‚¬ | ë§ˆì´ê·¸ë ˆì´ì…˜ ë‚´ìš© | ê¸°ê°„ | íŠ¹ì§• |
|------|-----------------|------|------|
| **Netflix** | Reloaded â†’ Cosmos (ë¯¸ë””ì–´ í”Œë«í¼) | 7ë…„ | ë‹¤ìš´íƒ€ì„ ì—†ì´ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì „í™˜ |
| **Amazon** | ëª¨ë†€ë¦¬ì‹ ë¦¬í…Œì¼ â†’ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ | ìˆ˜ë…„ | ì§€ì†ì  ê¸°ëŠ¥ ë°°í¬ ìœ ì§€ |
| **Shopify** | ì½”ì–´ ì„œë¹„ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ | - | 24/7 ì—…íƒ€ì„ ìœ ì§€í•˜ë©° ì „í™˜ |

> **í†µê³„**: ìŠ¤íŠ¸ë­ê¸€ëŸ¬ íŒ¨í„´ì„ ì ìš©í•œ ì¡°ì§ì€ "ë¹…ë±…" ë˜ëŠ” ë³‘ë ¬ êµ¬í˜„ ëŒ€ë¹„ **67% ì ì€ í”„ë¡œë•ì…˜ ì¥ì• **ë¥¼ ê²½í—˜

---

### Canary ë°°í¬ ì „ëµ

#### íŠ¸ë˜í”½ ë¼ìš°íŒ… ë‹¨ê³„ (ê¶Œì¥)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ê¶Œì¥ íŠ¸ë˜í”½ ì¦ê°€ íŒ¨í„´ (ë¡œê·¸ ìŠ¤ì¼€ì¼)                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  Stage 1:  1% â”€â”€â–¶ ìƒˆ ì„œë¹„ìŠ¤    (1ì‹œê°„ ëª¨ë‹ˆí„°ë§)                          â”‚
â”‚           99% â”€â”€â–¶ ë ˆê±°ì‹œ                                                 â”‚
â”‚                                                                          â”‚
â”‚  Stage 2:  5% â”€â”€â–¶ ìƒˆ ì„œë¹„ìŠ¤    (4ì‹œê°„ ëª¨ë‹ˆí„°ë§)                          â”‚
â”‚           95% â”€â”€â–¶ ë ˆê±°ì‹œ                                                 â”‚
â”‚                                                                          â”‚
â”‚  Stage 3: 25% â”€â”€â–¶ ìƒˆ ì„œë¹„ìŠ¤    (24ì‹œê°„ ëª¨ë‹ˆí„°ë§)                         â”‚
â”‚           75% â”€â”€â–¶ ë ˆê±°ì‹œ                                                 â”‚
â”‚                                                                          â”‚
â”‚  Stage 4: 50% â”€â”€â–¶ ìƒˆ ì„œë¹„ìŠ¤    (48ì‹œê°„ ëª¨ë‹ˆí„°ë§)                         â”‚
â”‚           50% â”€â”€â–¶ ë ˆê±°ì‹œ                                                 â”‚
â”‚                                                                          â”‚
â”‚  Stage 5: 100% â”€â”€â–¶ ìƒˆ ì„œë¹„ìŠ¤   (ë ˆê±°ì‹œ ë¼ìš°íŠ¸ ì œê±°)                      â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Read-First ì „ëµ (ë¦¬ìŠ¤í¬ ìµœì†Œí™”)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 1: READ ì—”ë“œí¬ì¸íŠ¸ ë¨¼ì € (ë¦¬ìŠ¤í¬ ë‚®ìŒ)                              â”‚
â”‚           GET /api/v1/products/**                                        â”‚
â”‚           GET /api/v1/categories/**                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Phase 2: WRITE ì—”ë“œí¬ì¸íŠ¸ (Read ì•ˆì •í™” í›„)                              â”‚
â”‚           POST /api/v1/products                                          â”‚
â”‚           PUT /api/v1/products/{id}                                      â”‚
â”‚           DELETE /api/v1/products/{id}                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ëª¨ë‹ˆí„°ë§ ì•„í‚¤í…ì²˜

#### Observability Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Observability Stack                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚   Metrics    â”‚  â”‚    Logs      â”‚  â”‚   Traces     â”‚                   â”‚
â”‚  â”‚  (Prometheus)â”‚  â”‚ (CloudWatch) â”‚  â”‚   (X-Ray)    â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚         â”‚                 â”‚                 â”‚                            â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                           â–¼                                              â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚                   â”‚   Dashboard   â”‚                                      â”‚
â”‚                   â”‚   (Grafana)   â”‚                                      â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### í•µì‹¬ ë¹„êµ ë©”íŠ¸ë¦­ (ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ ë² ì´ìŠ¤ë¼ì¸ ìˆ˜ì§‘ í•„ìˆ˜!)

| Metric | Legacy (Baseline) | New Service | Threshold |
|--------|-------------------|-------------|-----------|
| Response Time (p99) | 200ms | ??? | < 250ms |
| Error Rate | 0.1% | ??? | < 1% |
| Throughput | 1000 RPS | ??? | > 800 RPS |
| CPU Usage | 40% | ??? | < 70% |
| Memory Usage | 60% | ??? | < 80% |

#### ì•Œë¦¼ ì„¤ì •

```yaml
# ìë™ ë¡¤ë°± íŠ¸ë¦¬ê±° ì¡°ê±´
alerts:
  critical:
    - name: "High Error Rate"
      condition: error_rate > 1%
      duration: 5m
      action: AUTO_ROLLBACK

    - name: "Latency Spike"
      condition: p99_latency > 500ms
      duration: 5m
      action: AUTO_ROLLBACK

  warning:
    - name: "Elevated Error Rate"
      condition: error_rate > 0.5%
      duration: 10m
      action: ALERT_ONCALL

    - name: "Latency Increase"
      condition: p99_latency > 300ms
      duration: 10m
      action: ALERT_ONCALL
```

---

### ë¡¤ë°± ì „ëµ 3ë‹¨ê³„

#### Level 1: ì¦‰ì‹œ ë¡¤ë°± - Gateway ë¼ìš°íŒ… (ì´ˆ ë‹¨ìœ„)

```yaml
# ë¬¸ì œ ê°ì§€ â†’ Gateway ì„¤ì •ì—ì„œ í•´ë‹¹ ê²½ë¡œ ì œê±° â†’ ìë™ìœ¼ë¡œ ë ˆê±°ì‹œ í´ë°±

# ë¡¤ë°±: ë‹¨ìˆœíˆ ê²½ë¡œ ì œê±° ë˜ëŠ” ì£¼ì„ì²˜ë¦¬
- id: new-admin-service
  paths:
    - /api/v1/users/**
    # - /api/v1/products/**  â† ì´ ì¤„ë§Œ ì£¼ì„ì²˜ë¦¬í•˜ë©´ ë ˆê±°ì‹œë¡œ í´ë°±

# â±ï¸ ì†Œìš” ì‹œê°„: ìˆ˜ ì´ˆ (ì„¤ì • ë°°í¬)
```

#### Level 2: Feature Flag ë¡¤ë°± (ë°€ë¦¬ì´ˆ ë‹¨ìœ„)

```java
// Feature Flag ì„œë¹„ìŠ¤ ì—°ë™ (LaunchDarkly, Unleash, AWS AppConfig ë“±)
@Component
public class MigrationFeatureFlags {

    private final FeatureFlagClient featureFlags;

    // ëŸ°íƒ€ì„ì— ì¦‰ì‹œ on/off ê°€ëŠ¥ - ì¬ë°°í¬ ë¶ˆí•„ìš”
    public boolean isProductsV2Enabled() {
        return featureFlags.isEnabled("products-v2-migration");
    }
}

// Gateway Filterì—ì„œ Feature Flag ì²´í¬
@Component
public class FeatureFlagRoutingFilter implements GlobalFilter {

    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        String path = exchange.getRequest().getURI().getPath();

        if (path.startsWith("/api/v1/products") &&
            !featureFlags.isProductsV2Enabled()) {
            // Feature Flag OFF â†’ ë ˆê±°ì‹œë¡œ ê°•ì œ ë¼ìš°íŒ…
            return routeToLegacy(exchange, chain);
        }

        return chain.filter(exchange);
    }
}
```

#### Level 3: Circuit Breaker ìë™ ë¡¤ë°±

```java
// Spring Cloud Gateway + Resilience4j
@Bean
public RouteLocator routesWithCircuitBreaker(RouteLocatorBuilder builder) {
    return builder.routes()
        .route("products-with-fallback", r -> r
            .path("/api/v1/products/**")
            .filters(f -> f
                .circuitBreaker(config -> config
                    .setName("productsCircuitBreaker")
                    .setFallbackUri("forward:/fallback/legacy-products")))
            .uri("http://new-service"))
        .build();
}
```

```yaml
# Circuit Breaker ì„¤ì •
resilience4j:
  circuitbreaker:
    instances:
      productsCircuitBreaker:
        slidingWindowSize: 100
        failureRateThreshold: 50      # 50% ì‹¤íŒ¨ ì‹œ OPEN
        waitDurationInOpenState: 60s   # 60ì´ˆ í›„ HALF_OPEN
        permittedNumberOfCallsInHalfOpenState: 10
```

---

### Shadow Testing (ê¶Œì¥)

í”„ë¡œë•ì…˜ íŠ¸ë˜í”½ìœ¼ë¡œ ìƒˆ ì„œë¹„ìŠ¤ë¥¼ ê²€ì¦í•˜ë˜ ì‹¤ì œ ì‘ë‹µì€ ë ˆê±°ì‹œì—ì„œ ë°˜í™˜:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Shadow Testing Flow                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  Client Request                                                          â”‚
â”‚       â”‚                                                                  â”‚
â”‚       â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      API Gateway                                  â”‚   â”‚
â”‚  â”‚  1. ë ˆê±°ì‹œì—ì„œ ì‹¤ì œ ì‘ë‹µ ë°˜í™˜ âœ…                                   â”‚   â”‚
â”‚  â”‚  2. ìƒˆ ì„œë¹„ìŠ¤ì—ë„ ë™ì¼ ìš”ì²­ ì „ë‹¬ (ë¹„ë™ê¸°) ğŸ“¤                      â”‚   â”‚
â”‚  â”‚  3. ë‘ ì‘ë‹µ ë¹„êµ â†’ ë¶ˆì¼ì¹˜ ì‹œ ì•Œë¦¼ ğŸ””                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â”‚  ì¥ì :                                                                   â”‚
â”‚  - ì‹¤ì œ í”„ë¡œë•ì…˜ íŠ¸ë˜í”½ìœ¼ë¡œ ê²€ì¦                                         â”‚
â”‚  - ì‚¬ìš©ìì—ê²Œ ì˜í–¥ ì—†ìŒ (ë¦¬ìŠ¤í¬ ì œë¡œ)                                    â”‚
â”‚  - ì„±ëŠ¥/ì •í™•ë„ ë¹„êµ ê°€ëŠ¥                                                 â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### í”„ë¡œë•ì…˜ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Production Architecture                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚   Client    â”‚                                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚         â”‚                                                                â”‚
â”‚         â–¼                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    API Gateway                                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  Feature Flag Check â†’ Circuit Breaker â†’ Traffic Split    â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                          â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚         â”‚                    â”‚                    â”‚                    â”‚
â”‚         â–¼ (1%)               â–¼ (99%)              â–¼                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ New Service â”‚      â”‚   Legacy    â”‚      â”‚   Shadow    â”‚            â”‚
â”‚  â”‚  (Canary)   â”‚      â”‚   Service   â”‚      â”‚   Service   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚         â”‚                    â”‚                    â”‚                    â”‚
â”‚         â–¼                    â–¼                    â–¼                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      (ê²°ê³¼ ë¹„êµë§Œ)              â”‚
â”‚  â”‚   New DB    â”‚      â”‚  Legacy DB  â”‚                                  â”‚
â”‚  â”‚  (Phase 2+) â”‚      â”‚             â”‚                                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Gateway ì„¤ì • ì˜ˆì‹œ (Canary + Feature Flag)

```yaml
# application-prod.yml
gateway:
  routing:
    services:
      # ===================================
      # 1ï¸âƒ£ ë§ˆì´ê·¸ë ˆì´ì…˜ëœ ì—”ë“œí¬ì¸íŠ¸ (Canary)
      # ===================================
      - id: new-admin-service
        uri: http://new-admin-api.connectly.local:8080
        paths:
          - /api/v1/users/**        # ìƒˆ ì„œë²„ë¡œ ë¼ìš°íŒ…
          - /api/v1/products/**     # ìƒˆ ì„œë²„ë¡œ ë¼ìš°íŒ…
        hosts:
          - admin.set-of.com
        public-paths: []            # JWT ì¸ì¦ í•„ìš” (ê²Œì´íŠ¸ì›¨ì´ì—ì„œ ì²˜ë¦¬)
        # traffic-weight: 5         # (êµ¬í˜„ ì‹œ) 5% íŠ¸ë˜í”½ë§Œ ìƒˆ ì„œë¹„ìŠ¤ë¡œ
        # fallback-service: legacy-admin

      # ===================================
      # 2ï¸âƒ£ ë ˆê±°ì‹œ catch-all
      # ===================================
      - id: legacy-admin
        uri: http://legacy-admin-alb.internal:8080
        paths:
          - /**                     # ë‚˜ë¨¸ì§€ ì „ë¶€
        hosts:
          - admin.set-of.com
        public-paths:
          - /**                     # ë ˆê±°ì‹œëŠ” ìì²´ ì¸ì¦
```

---

### ìš´ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

#### ë§ˆì´ê·¸ë ˆì´ì…˜ ì „
- [ ] ë ˆê±°ì‹œ ì„œë¹„ìŠ¤ ë² ì´ìŠ¤ë¼ì¸ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ (ìµœì†Œ 2ì£¼)
- [ ] ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ êµ¬ì¶• (Grafana/CloudWatch)
- [ ] ì•Œë¦¼ ì„¤ì • (Slack, PagerDuty ì—°ë™)
- [ ] ë¡¤ë°± ì ˆì°¨ ë¬¸ì„œí™” ë° íŒ€ í›ˆë ¨
- [ ] Shadow Testing í™˜ê²½ êµ¬ì¶• (ì„ íƒ)

#### ê° ì—”ë“œí¬ì¸íŠ¸ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œ
- [ ] Shadow Testing í†µê³¼ (ì„ íƒ)
- [ ] 1% â†’ 5% â†’ 25% â†’ 50% â†’ 100% ë‹¨ê³„ì  ì „í™˜
- [ ] ê° ë‹¨ê³„ë³„ ìµœì†Œ ëª¨ë‹ˆí„°ë§ ê¸°ê°„ ì¤€ìˆ˜
- [ ] ì—ëŸ¬ìœ¨ < 1% í™•ì¸
- [ ] Latency < baseline Ã— 1.2 í™•ì¸
- [ ] ë¡¤ë°± í…ŒìŠ¤íŠ¸ ì™„ë£Œ (ì‹¤ì œ ë¡¤ë°± 1íšŒ ì´ìƒ ìˆ˜í–‰)

#### ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ í›„
- [ ] ë ˆê±°ì‹œ ë¼ìš°íŠ¸ ì œê±°
- [ ] ë ˆê±°ì‹œ ì„œë¹„ìŠ¤ sunset ì¼ì • í™•ì •
- [ ] ë¬¸ì„œ ì—…ë°ì´íŠ¸
- [ ] íšŒê³  ì§„í–‰

---

## ì°¸ê³  ìë£Œ

- [Strangler Fig Pattern - Martin Fowler](https://martinfowler.com/bliki/StranglerFigApplication.html)
- [Branch by Abstraction](https://martinfowler.com/bliki/BranchByAbstraction.html)
- [AWS Prescriptive Guidance - Strangler Fig Pattern](https://docs.aws.amazon.com/prescriptive-guidance/latest/cloud-design-patterns/strangler-fig.html)
- [Shopify Engineering - Refactoring with Strangler Fig](https://shopify.engineering/refactoring-legacy-code-strangler-fig-pattern)
- [CircleCI - Strangler Pattern Implementation](https://circleci.com/blog/strangler-pattern-implementation-for-safe-microservices-transition/)
- [Microsoft Azure - Strangler Fig Pattern](https://learn.microsoft.com/en-us/azure/architecture/patterns/strangler-fig)
- [Harness - Canary Releases and Feature Flags](https://www.harness.io/blog/canary-release-feature-flags)
- [Thoughtworks - Embracing Strangler Fig](https://www.thoughtworks.com/en-us/insights/articles/embracing-strangler-fig-pattern-legacy-modernization-part-one)
