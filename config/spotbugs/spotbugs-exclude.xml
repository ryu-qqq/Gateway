<?xml version="1.0" encoding="UTF-8"?>
<!--
    SpotBugs Exclusion Configuration
    Enterprise Spring Boot Standards

    @author Architecture Team (arch-team@company.com)
    @since 2024-01-01
-->
<FindBugsFilter>
    <!-- ========================================
         Exclude Generated Code
         ======================================== -->
    <Match>
        <Class name="~.*\.Q.*"/>  <!-- QueryDSL generated classes -->
    </Match>

    <Match>
        <Package name="~.*\.generated\..*"/>
    </Match>

    <!-- ========================================
         Exclude Test Code from Certain Rules
         JUnit 5 테스트 클래스는 @Mock, @Autowired 등으로 필드 초기화되므로
         생성자 초기화 검사 제외
         ======================================== -->
    <Match>
        <Class name="~.*Test"/>
        <Bug pattern="DMI_HARDCODED_ABSOLUTE_FILENAME"/>
    </Match>

    <!-- Test: UwF (Unwritten Field) - @Mock, @Autowired 필드 -->
    <Match>
        <Class name="~.*Test"/>
        <Bug pattern="UWF_FIELD_NOT_INITIALIZED_IN_CONSTRUCTOR"/>
    </Match>

    <!-- Test: NP (Null Pointer) - null 처리 테스트 -->
    <Match>
        <Class name="~.*Test"/>
        <Bug pattern="NP_LOAD_OF_KNOWN_NULL_VALUE,NP_NULL_ON_SOME_PATH,NP_NULL_PARAM_DEREF"/>
    </Match>

    <!-- Test: DLS (Dead Local Store) - 테스트 변수 -->
    <Match>
        <Class name="~.*Test"/>
        <Bug pattern="DLS_DEAD_LOCAL_STORE"/>
    </Match>

    <!-- Test: SA (Self Assignment) - 동등성 테스트 -->
    <Match>
        <Class name="~.*Test"/>
        <Bug pattern="SA_LOCAL_SELF_COMPARISON,SA_FIELD_SELF_COMPARISON"/>
    </Match>

    <!-- Test: SIC (Static Inner Class) - 익명 클래스 -->
    <Match>
        <Class name="~.*Test\$.*"/>
        <Bug pattern="SIC_INNER_SHOULD_BE_STATIC_ANON,SIC_INNER_SHOULD_BE_STATIC"/>
    </Match>

    <!-- RestDocs Test 클래스 -->
    <Match>
        <Class name="~.*RestDocsTest"/>
        <Bug pattern="UWF_FIELD_NOT_INITIALIZED_IN_CONSTRUCTOR"/>
    </Match>

    <!-- ========================================
         Configuration Classes
         ======================================== -->
    <Match>
        <Class name="~.*Configuration"/>
        <Bug pattern="UWF_FIELD_NOT_INITIALIZED_IN_CONSTRUCTOR"/>
    </Match>

    <Match>
        <Class name="~.*Config"/>
        <Bug pattern="UWF_FIELD_NOT_INITIALIZED_IN_CONSTRUCTOR,EI_EXPOSE_REP2"/>
    </Match>

    <!-- ========================================
         Domain Layer Exceptions
         Exception의 args()는 의도적으로 내부 배열 반환
         ======================================== -->
    <Match>
        <Class name="~.*Exception"/>
        <Bug pattern="EI_EXPOSE_REP"/>
    </Match>

    <!-- ========================================
         Locale-independent String operations
         enum/VO에서 입력 정규화는 locale-independent가 의도된 동작
         ======================================== -->
    <Match>
        <Package name="~com\.ryuqq\.gateway\.domain\..*"/>
        <Bug pattern="DM_CONVERT_CASE"/>
    </Match>

    <!-- ========================================
         DTO/Response 내부 표현 노출 (의도된 동작)
         Record/DTO는 데이터 컨테이너이므로 내부 리스트 반환이 정상
         ======================================== -->
    <Match>
        <Or>
            <Class name="~.*Response"/>
            <Class name="~.*Command"/>
            <Class name="~.*Query"/>
            <Class name="~.*DTO"/>
            <Class name="~.*Dto"/>
        </Or>
        <Bug pattern="EI_EXPOSE_REP,EI_EXPOSE_REP2"/>
    </Match>

    <!-- ========================================
         Redis Entity 내부 표현 노출 (의도된 동작)
         Entity는 데이터 컨테이너이므로 내부 리스트 반환이 정상
         ======================================== -->
    <Match>
        <Package name="~.*\.redis\.entity"/>
        <Bug pattern="EI_EXPOSE_REP,EI_EXPOSE_REP2"/>
    </Match>

    <Match>
        <Class name="~.*Entity"/>
        <Bug pattern="EI_EXPOSE_REP,EI_EXPOSE_REP2"/>
    </Match>

    <!-- ========================================
         의존성 주입 패턴 (Spring 표준)
         생성자에서 외부 객체 저장은 DI 패턴의 정상 동작
         ======================================== -->
    <Match>
        <Or>
            <Class name="~.*Service"/>
            <Class name="~.*UseCase"/>
            <Class name="~.*Facade"/>
            <Class name="~.*Manager"/>
            <Class name="~.*Adapter"/>
            <Class name="~.*Handler"/>
            <Class name="~.*Controller"/>
            <Class name="~.*Repository"/>
        </Or>
        <Bug pattern="EI_EXPOSE_REP2"/>
    </Match>

    <!-- ========================================
         JWT/Security 초기화 패턴
         JWT 키 초기화 시 예외 발생 가능 (의도된 fail-fast)
         ======================================== -->
    <Match>
        <Class name="~.*JwtTokenProvider.*"/>
        <Bug pattern="CT_CONSTRUCTOR_THROW"/>
    </Match>

    <!-- ========================================
         Redis/Redisson 설정 패턴
         Redisson Config 타입 캐스팅은 라이브러리 패턴
         ======================================== -->
    <Match>
        <Or>
            <Class name="~.*RedissonConfig"/>
            <Class name="~.*RedisConfig"/>
            <Class name="~.*LettuceConfig"/>
            <Class name="~.*AuthHubConfig"/>
        </Or>
        <Bug pattern="BC_UNCONFIRMED_CAST,BC_UNCONFIRMED_CAST_OF_RETURN_VALUE"/>
    </Match>

    <!-- ========================================
         Cache Adapter 주입 필드
         ObjectMapper 등 인프라 필드는 향후 사용 예정
         ======================================== -->
    <Match>
        <Class name="~.*CacheAdapter"/>
        <Bug pattern="URF_UNREAD_FIELD"/>
    </Match>

    <!-- ========================================
         Spring Security Config 클래스
         Security 설정은 많은 의존성 주입 필요
         ======================================== -->
    <Match>
        <Or>
            <Class name="~.*SecurityConfig"/>
            <Class name="~.*SecurityPaths"/>
            <Class name="~.*Filter"/>
            <Class name="~.*ErrorMapperRegistry"/>
        </Or>
        <Bug pattern="EI_EXPOSE_REP2,MS_EXPOSE_REP,MS_MUTABLE_ARRAY,MS_SHOULD_BE_FINAL,MS_PKGPROTECT,UPM_UNCALLED_PRIVATE_METHOD"/>
    </Match>

    <!-- ========================================
         Spring @ConfigurationProperties 클래스
         Setter/Getter는 Spring 바인딩에 필요
         ======================================== -->
    <Match>
        <Class name="~.*Properties"/>
        <Bug pattern="EI_EXPOSE_REP,EI_EXPOSE_REP2"/>
    </Match>

    <!-- ========================================
         Controller/Handler 의존성 주입
         Spring MVC 표준 패턴
         ======================================== -->
    <Match>
        <Or>
            <Class name="~.*Handler"/>
            <Class name="~.*Registry"/>
        </Or>
        <Bug pattern="EI_EXPOSE_REP2"/>
    </Match>

    <!-- ========================================
         Exception Handling - Assert Null Check
         Spring이 null을 반환하지 않음을 신뢰
         ======================================== -->
    <Match>
        <Class name="~.*ExceptionHandler"/>
        <Bug pattern="NP_NULL_ON_SOME_PATH_FROM_RETURN_VALUE"/>
    </Match>

    <!-- ========================================
         OAuth2 Handler Exception Catching
         URL 검증에서 예외 catch는 의도된 동작
         ======================================== -->
    <Match>
        <Class name="~.*OAuth2.*Handler"/>
        <Bug pattern="REC_CATCH_EXCEPTION"/>
    </Match>

    <!-- ========================================
         Query/Search DTO 내부 List 노출
         API Request는 내부 List 반환이 정상
         ======================================== -->
    <Match>
        <Or>
            <Class name="~.*ApiRequest"/>
            <Class name="~.*SearchApiRequest"/>
        </Or>
        <Bug pattern="EI_EXPOSE_REP,EI_EXPOSE_REP2"/>
    </Match>

    <!-- ========================================
         AuthHub Client 패턴
         WebClient Builder 설정은 라이브러리 패턴
         ======================================== -->
    <Match>
        <Package name="~.*\.authhub\.client"/>
        <Bug pattern="BC_UNCONFIRMED_CAST,BC_UNCONFIRMED_CAST_OF_RETURN_VALUE,DM_CONVERT_CASE"/>
    </Match>

    <!-- ========================================
         Gateway Filter 패턴
         WebFlux ServerWebExchange API는 체이닝 필요
         ======================================== -->
    <Match>
        <Package name="~.*\.gateway\.filter"/>
        <Bug pattern="EI_EXPOSE_REP,EI_EXPOSE_REP2"/>
    </Match>

    <!-- ========================================
         Gateway Common Util 패턴
         ObjectMapper 등 인프라 의존성 주입
         ======================================== -->
    <Match>
        <Package name="~.*\.gateway\.common\.util"/>
        <Bug pattern="EI_EXPOSE_REP,EI_EXPOSE_REP2"/>
    </Match>

    <!-- ========================================
         Controller 내부 Record 클래스
         Webhook Request 등은 내부 리스트 반환이 정상
         ======================================== -->
    <Match>
        <Class name="~.*Controller\$.*"/>
        <Bug pattern="EI_EXPOSE_REP,EI_EXPOSE_REP2"/>
    </Match>

    <!-- ========================================
         Responder/Utility 클래스
         ObjectMapper 등 인프라 의존성 주입
         ======================================== -->
    <Match>
        <Class name="~.*Responder"/>
        <Bug pattern="EI_EXPOSE_REP,EI_EXPOSE_REP2"/>
    </Match>
</FindBugsFilter>
